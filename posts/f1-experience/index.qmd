---
title: "Is experience the biggest predictor of F1 teammate battles?"
date: "2025-04-03"
categories: [r, f1]
warning: false
code-fold: true
freeze: false
---

It's just before round three of the 2025 F1 season, Suzuka. Liam Lawson's pre-doomed stint in the Red Bull seat has just finished and Tsunoda is in. Will he fare any better?

Given that Lawson had just 11 races under his belt prior to this season, whereas Tsunoda has 90, I strongly suspect that he will. I _think_ that experience is at least as big a factor in driver performance as natural ability. Let's explore that!

```{r} 
library(tidyverse)
library(knitr)

results <- read_csv("data/results.csv", col_select = c("raceId", "driverId", "constructorId", "positionOrder", "laps", "milliseconds"), col_types = "iiidii", na = "\\N", show_col_types = FALSE)
races <- read_csv("data/races.csv", col_select = c("raceId", "year", "round"), col_types = "iii", show_col_types = FALSE)
drivs <- read_csv("data/drivers.csv", col_select = c("driverId", "driverRef", "code"), na = "\\N", show_col_types = FALSE)
ctors <- read_csv("data/constructors.csv", col_select = c("constructorId", "constructorRef"), show_col_types = FALSE)

race.cars <- races |>
  merge(results) |>
  group_by(year, round) |>
  summarise(n.cars = n())

raw.df <- results |>
  merge(races) |>
  merge(drivs) |>
  merge(ctors) |>
  merge(race.cars)

raw.df |>
  filter(code == "TSU") |>
  group_by(year) |>
  count()
```

There are three ways we could measure the experience of a driver: number of race starts, number of laps raced, and seasons endured.

```{r}
#| label: tbl-n-starts
#| tbl-cap: Number of race starts, laps raced, and seasons endured for drivers who raced in 2024.
driver.seasons <- raw.df |>
  distinct(driverId, year) |>
  arrange(driverId, year) |>
  group_by(driverId) |>
  mutate(n.seasons = 1, n.seasons = cumsum(n.seasons))

driver.experience <- raw.df |>
  group_by(driverId) |>
  arrange(year, raceId) |>
  mutate(n.starts = 1, n.starts = cumsum(n.starts), n.laps = cumsum(laps)) |>
  merge(driver.seasons)

driver.experience |>
  group_by(driverId, driverRef, code) |>
  filter(max(year) == 2024) |>
  summarise(n.starts = max(n.starts), n.laps = max(n.laps), n.seasons = max(n.seasons)) |>
  arrange(desc(n.starts)) |>
  kable()
```

Race starts is the most typical measure of driver experience. You might extend the idea of experience accumulating race by race to experience accumulating lap by lap, which would be particularly helpful to distinguish drivers in their earliest stages for whom every complete race is a significant chunk of experience. We might also consider whether the number of different cars raced helps, which is the same as the number of seasons except for those rare occasions when a driver jumps into two different cars in one seasons.

For now I'm going to ignore career breaks to simplify things. However we definitely saw that Schumacher, Ocon, and Alonso underperformed after their breaks.

With each measure calculated for each driver for each race, we can look at how the difference in experience measure relates to teammate battle outcomes. For each pairing, for each race, we will calculate the finishing positions difference vs each experience measure.


```{r}
pairs <- driver.experience |>
  group_by(year, round, constructorId) |>
  arrange(positionOrder) |>
  summarise(
    positions.ahead = last(positionOrder) - first(positionOrder),
    n.laps.diff = first(n.laps) - last(n.laps),
    n.starts.diff = first(n.starts) - last(n.starts),
    n.seasons.diff = first(n.seasons) - last(n.seasons)
  ) |>
  pivot_longer(starts_with("n") & ends_with("diff"))

ggplot(pairs) +
  aes(x = value, y = positions.ahead, group = name) +
  facet_wrap(~name, scales = "free_x") +
  geom_point(alpha = 0.1) +
  stat_smooth() +
  theme_minimal()
```
